#!/usr/bin/python3

import sys
from powered_g import *

script_path = os.path.dirname(os.path.realpath(__file__))


def giti_update(none):
    print("The old version of GITI will be deleted and the new one will be downloaded")
    # check if update.sh exists in the script path
    if os.path.exists(f"{script_path}/update.sh"):
        os.system(f"{script_path}/update.sh")
        exit()
    print("The update script is missing at script location. Will now look in default location")
    # check if update.sh exists in the default location ~/.giti
    if os.path.exists(f"{os.path.expanduser('~')}/.giti/update.sh"):
        os.system(f"{os.path.expanduser('~')}/.giti/update.sh")
        exit()


commands_dict = {
    "all": giti_all,
    "make": giti_makefile,
    "style": giti_coding_style,
    "igit": giti_ignore,
    "del": giti_del,
    "--update": giti_update
}


def main():
    if len(sys.argv) < 2:
        print("GITI: No command given")
        exit()
    command = sys.argv[1]
    args = sys.argv[2:]
    if command in commands_dict:
        commands_dict[command](args[0] if len(args) > 0 else "")
    else:
        title = ""
        comment = ""
        files = []
        for arg in args:
            if arg == "-nc":
                title = args[args.index(arg) + 1]
                files = args[args.index(arg) + 2:]
                break
            elif arg == "-nt":
                comment = args[args.index(arg) + 1]
                files = args[args.index(arg) + 2:]
                break
            elif arg == "-ntc" or arg == "-nct":
                files = args[args.index(arg) + 1:]
                break
            else:
                title = args[0]
                comment = args[1]
                files = args[2:]
        generic_giti(command, title, comment, files)


main()
